<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> observing ECCO vs tidal gauges affected by Hurricane Maria; a deep dive | Faith Hunja </title> <meta name="author" content="Faith Hunja"> <meta name="description" content="an analysis of the credibility of SSH data sources under the impact of extreme weather events, with a focus on Hurricane Maria"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%93%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://faithhunja.github.io/blog/2024/CISP2023/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Faith</span> Hunja </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/experience/">experience </a> </li> <li class="nav-item "> <a class="nav-link" href="/awards/">awards </a> </li> <li class="nav-item "> <a class="nav-link" href="/education/">education </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">observing ECCO vs tidal gauges affected by Hurricane Maria; a deep dive</h1> <p class="post-meta"> March 23, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/climate-data-science"> <i class="fa-solid fa-hashtag fa-sm"></i> climate data science</a>   <a href="/blog/tag/sea-surface-height"> <i class="fa-solid fa-hashtag fa-sm"></i> sea surface height</a>   <a href="/blog/tag/deep-dive"> <i class="fa-solid fa-hashtag fa-sm"></i> deep dive</a>   </p> </header> <article class="post-content"> <details> <summary>Table of Contents</summary> <div id="table-of-contents"> <ul id="toc" class="section-nav"> <li class="toc-entry toc-h2"><a href="#introduction">Introduction</a></li> <li class="toc-entry toc-h2"> <a href="#methods">Methods</a> <ul> <li class="toc-entry toc-h3"> <a href="#ssh-data-retrieval">SSH data retrieval</a> <ul> <li class="toc-entry toc-h4"><a href="#ssh-data-sources">SSH data sources</a></li> <li class="toc-entry toc-h4"><a href="#ssh-data-retrieval-from-ecco">SSH data retrieval from ECCO</a></li> <li class="toc-entry toc-h4"><a href="#ssh-data-retrieval-from-uhslctg">SSH data retrieval from UHSLC/TG</a></li> <li class="toc-entry toc-h4"><a href="#ssh-data-access-for-ecco">SSH data access for ECCO</a></li> <li class="toc-entry toc-h4"><a href="#ssh-data-access-for-uhslctg">SSH data access for UHSLC/TG</a></li> </ul> </li> <li class="toc-entry toc-h3"> <a href="#ssh-data-preliminary-analysis---only-for-hurricane-maria-dates">SSH data preliminary analysis - only for Hurricane Maria dates</a> <ul> <li class="toc-entry toc-h4"><a href="#statistical-analysis">Statistical analysis</a></li> <li class="toc-entry toc-h4"><a href="#discussion">Discussion</a></li> </ul> </li> <li class="toc-entry toc-h3"> <a href="#ssh-data-analysis---entire-dataset">SSH data analysis - entire dataset</a> <ul> <li class="toc-entry toc-h4"><a href="#rolling-mean-comparison">Rolling mean comparison</a></li> <li class="toc-entry toc-h4"><a href="#rolling-standard-deviation-comparison">Rolling standard deviation comparison</a></li> <li class="toc-entry toc-h4"><a href="#pearson-correlations">Pearson correlations</a></li> <li class="toc-entry toc-h4"><a href="#time-series-plotting">Time series plotting</a></li> <li class="toc-entry toc-h4"><a href="#discussion-1">Discussion</a></li> </ul> </li> </ul> </li> <li class="toc-entry toc-h2"> <a href="#conclusion">Conclusion</a> <ul> <li class="toc-entry toc-h3"><a href="#notes">Notes</a></li> <li class="toc-entry toc-h3"><a href="#acknowledgements">Acknowledgements</a></li> <li class="toc-entry toc-h3"><a href="#references">References</a></li> </ul> </li> </ul> </div> <hr> </details> <div id="markdown-content"> <h2 id="introduction">Introduction</h2> <p>Sea level rise is an increase in the ocean’s surface height relative to the land in a particular location, mainly caused by expansion of warm ocean water and melting polar ice [<a href="https://www.whoi.edu/know-your-ocean/ocean-topics/climate-weather/sea-level-rise/" rel="external nofollow noopener" target="_blank">1</a>]. Sea surface height (SSH) can be measured in situ using tide gauges (TGs), or using satellite altimeters. Tide gauges, found in water level monitoring stations, are fitted with sensors that continuously record the height of the surrounding water level [<a href="https://oceanservice.noaa.gov/facts/tide-gauge.html" rel="external nofollow noopener" target="_blank">2</a>]. On the other hand, satellite altimeters measure SSH by measuring the time it takes for microwave pulses to travel from the satellite and sea surface at nadir (the lowest point). Satellite altimeters assume that the pulse reflections are homogeneous.</p> <p>However, in coastal areas, there are various sources of inhomogeneous microwave reflections, such as lands, ships, and smooth water in ports, which decrease the quality of the altimeters’ estimations of the SSH [<a href="https://doi.org/10.1016/B978-0-323-91708-7.00011-0" rel="external nofollow noopener" target="_blank">3</a>]. Furthermore, under the influence of extreme weather events, such as hurricanes, such discrepancies are further exposed due to the increased change is SSH levels. Tide gauge measurements are made with respect to a local fixed reference on land [<a href="https://tidesandcurrents.noaa.gov/sltrends/" rel="external nofollow noopener" target="_blank">4</a>], therefore their measurements are more accurate, but they are susceptible to extreme weather. Thus there exists a need to consolidate SSH data measured during extreme events by tide gauges and satellite altimeters.</p> <p>This article describes a project comparing SSH data measured from tide gauges in Puerto Rico that were affected by Hurricane Maria, and the corresponding SSH data sourced from satellite altimeters.</p> <h2 id="methods">Methods</h2> <h3 id="ssh-data-retrieval">SSH data retrieval</h3> <h4 id="ssh-data-sources">SSH data sources</h4> <p>SSH data can be obtained from satellite altimeters and tide gauges. For the satellite source, we used <a href="https://ecco-group.org/products-ECCO-V4r4.htm" rel="external nofollow noopener" target="_blank">ECCO Version 4 Release 4</a>, which covers the period from January 1992 to December 2017 [<a href="https://data.nas.nasa.gov/ecco/data.php?dir=/eccodata/llc_90/ECCOv4/Release4" rel="external nofollow noopener" target="_blank">5</a>], [<a href="https://doi.org/10.5281/zenodo.4533349" rel="external nofollow noopener" target="_blank">6</a>], [<a href="https://www.geosci-model-dev.net/8/3071/2015/" rel="external nofollow noopener" target="_blank">7</a>]. ECCO is the abbreviation for “Estimating the Circulation and Climate of the Ocean”. The instructions to download the dataset follow in the website indicated. For this project, we specifically used <strong>‘Option 2: Daily Fields on the NASA Advanced Supercomputing (NAS) ECCO Data Portal’</strong>.</p> <p>SSH data from the TGs was obtained from the <a href="https://UHSLC/TG.soest.hawaii.edu/" rel="external nofollow noopener" target="_blank">University of Hawaii Sea Level Center</a> (UHSLC/TG) database. Since we focused on the areas affected by Hurricane Maria in Puerto Rico, we used SSH data from 6 TGs, namely: Penuelas, Isabel Segunda, Esperanza, Arecibo, Mayaguez and Fajardo.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog_pics/2024-03-23-CISP2023/maria_locations-480.webp 480w,/assets/img/blog_pics/2024-03-23-CISP2023/maria_locations-800.webp 800w,/assets/img/blog_pics/2024-03-23-CISP2023/maria_locations-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/blog_pics/2024-03-23-CISP2023/maria_locations.png" width="100%" height="auto" alt="Hurricane Maria tide gauge locations" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Puerto Rico tide gauge locations affected by Hurricane Maria</figcaption> </figure> <p>To begin with, we import libraries required for running the code.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">xarray</span> <span class="k">as</span> <span class="n">xr</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">pooch</span>
<span class="kn">import</span> <span class="n">tempfile</span>
<span class="kn">from</span> <span class="n">pooch</span> <span class="kn">import</span> <span class="n">HTTPDownloader</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="n">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</code></pre></div></div> <p>Then we create dictionaries to store SSH data we will retrieve from the satellite and the tide gauges. Initially, we did an analysis of 3 hurricanes, so we created a dictionary, to store the parameters for each hurricane. However, in the end, we only focussed on Hurricane Maria, but still kept the dictionary in case of any changes in the direction of our focus. Inside the dictionary, we define various parameters, such as the starting and ending dates for our analysis, as well as the latitude and longitude coordinates for each tide gauge.</p> <p>We create two dictionaries; <code class="language-plaintext highlighter-rouge">storm_repo_full</code> and <code class="language-plaintext highlighter-rouge">storm_repo_event</code>, whose difference is that <code class="language-plaintext highlighter-rouge">storm_repo_full</code> is for the entire time range for ECCO, which is from 1992 until 2017, while <code class="language-plaintext highlighter-rouge">storm_repo_event</code> is only for the 17 days of Hurricane Maria, which is from 16th September to 2nd October 2017.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">storm_repo_full</span> <span class="o">=</span> <span class="p">{</span>    
        <span class="sh">"</span><span class="s">Maria</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">start_date</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">1992</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">end_date</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">tide</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Spring</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">duration</span><span class="sh">"</span><span class="p">:</span> <span class="mi">9497</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">maxIntensity_kt</span><span class="sh">"</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">maxIntensity_mb</span><span class="sh">"</span><span class="p">:</span> <span class="mi">908</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">tg</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">Penuelas, PR</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">17.972</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">66.762</span><span class="p">},</span>
               <span class="sh">"</span><span class="s">Isabel Segunda, PR</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">18.152</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">65.443</span><span class="p">},</span>
               <span class="sh">"</span><span class="s">Esperanza, PR</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">18.093</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">65.47</span><span class="p">},</span>
               <span class="sh">"</span><span class="s">Arecibo, PR</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">18.48</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">66.702</span><span class="p">},</span>
               <span class="sh">"</span><span class="s">Mayaguez, PR</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">18.22</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">67.16</span><span class="p">},</span>
               <span class="sh">"</span><span class="s">Fajardo, PR</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">18.333</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">65.633</span><span class="p">}},</span>
        <span class="sh">"</span><span class="s">tg_precise</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">Penuelas, PR (precise)</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">17.4</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">66.762</span><span class="p">,</span> 
                                       <span class="sh">"</span><span class="s">record_start</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
                                       <span class="sh">"</span><span class="s">record_end</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)},</span>
            <span class="sh">"</span><span class="s">Isabel Segunda, PR (precise)</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">18.152</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">65.443</span><span class="p">,</span> 
                                             <span class="sh">"</span><span class="s">record_start</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> 
                                             <span class="sh">"</span><span class="s">record_end</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">19</span><span class="p">)},</span>
            <span class="sh">"</span><span class="s">Esperanza, PR (precise)</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">18.093</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">65.47</span><span class="p">,</span> 
                                        <span class="sh">"</span><span class="s">record_start</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> 
                                        <span class="sh">"</span><span class="s">record_end</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)},</span>
            <span class="sh">"</span><span class="s">Arecibo, PR (precise)</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">18.5</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">66.702</span><span class="p">,</span> 
                                      <span class="sh">"</span><span class="s">record_start</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span> 
                                      <span class="sh">"</span><span class="s">record_end</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)},</span>
            <span class="sh">"</span><span class="s">Mayaguez, PR (precise)</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">18.22</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">67.16</span><span class="p">,</span> 
                                       <span class="sh">"</span><span class="s">record_start</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> 
                                       <span class="sh">"</span><span class="s">record_end</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)},</span>
            <span class="sh">"</span><span class="s">Fajardo, PR (precise)</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">:</span> <span class="mf">18.333</span><span class="p">,</span> <span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">:</span> <span class="o">-</span><span class="mf">65.633</span><span class="p">,</span> 
                                      <span class="sh">"</span><span class="s">record_start</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">1992</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
                                      <span class="sh">"</span><span class="s">record_end</span><span class="sh">"</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>WILL HAVE TO CONFIRM THIS FROM THE CMA WORK HUDDLE!!!</p> <p>Both <code class="language-plaintext highlighter-rouge">tg</code> and <code class="language-plaintext highlighter-rouge">tg_precise</code> represent the tide gauge location coordinates, however <code class="language-plaintext highlighter-rouge">tg_precise</code> shows the coordinates of the closest gridcell that corresponds to the particular location, hence it is more accurate. <code class="language-plaintext highlighter-rouge">record_start</code> and <code class="language-plaintext highlighter-rouge">record_end</code> specify the duration during which SSH data was available for each tide gauge.</p> <p><code class="language-plaintext highlighter-rouge">tg_repo</code> is another dictionary used to store the SSH data sourced directly from the UHSLC/TG database, whose temporal resolution is hourly. We specify the urls where we obtain data for the tide gauges.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tg_repo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">Maria</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">Penuelas, PR</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">https://UHSLC/TG.soest.hawaii.edu/data/netcdf/rqds/atlantic/hourly/h243a.nc</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Isabel Segunda, PR</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">https://UHSLC/TG.soest.hawaii.edu/data/netcdf/rqds/atlantic/hourly/h732a.nc</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Esperanza, PR</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">https://UHSLC/TG.soest.hawaii.edu/data/netcdf/rqds/atlantic/hourly/h733a.nc</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Arecibo, PR</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">https://UHSLC/TG.soest.hawaii.edu/data/netcdf/rqds/atlantic/hourly/h735a.nc</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Mayaguez, PR</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">https://UHSLC/TG.soest.hawaii.edu/data/netcdf/rqds/atlantic/hourly/h736a.nc</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Fajardo, PR</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">https://UHSLC/TG.soest.hawaii.edu/data/netcdf/rqds/atlantic/hourly/h783b.nc</span><span class="sh">"</span>
                <span class="p">},</span>
        <span class="p">}</span>       
</code></pre></div></div> <p>Next, we access the SSH data from ECCO. For this purpose, we define a function <code class="language-plaintext highlighter-rouge">get_ds_for_date_range</code> which takes the following parameters:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">start_date</code> and <code class="language-plaintext highlighter-rouge">end_date</code>: defining the range of dates for which we want to retrieve the SSH data.</li> <li> <code class="language-plaintext highlighter-rouge">lati</code> and <code class="language-plaintext highlighter-rouge">longi</code>: representing latitude and longitude coordinates for the location which we want to retrieve the data.</li> <li> <code class="language-plaintext highlighter-rouge">auth</code>: which is a tuple containing two variables - the user’s username and password - from an account which you can create <a href="https://urs.earthdata.nasa.gov/home" rel="external nofollow noopener" target="_blank">here</a> to access SSH data from ECCO.</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_ds_for_date_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">lati</span><span class="p">,</span> <span class="n">longi</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">):</span>
    
    <span class="c1"># Calculate the number of days in the range
</span>    <span class="n">num_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span><span class="p">).</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span>
        
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">range</span><span class="sh">"</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ds_files</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_days</span><span class="p">):</span>
        <span class="n">date_req</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_date</span> <span class="o">+</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)).</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y-%m-%d</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">ecco_url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://ecco.jpl.nasa.gov/drive/files/Version4/Release4b/latlon/daily/SSH</span><span class="sh">"</span>
        <span class="n">file_req</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">SEA_SURFACE_HEIGHT_day_mean_</span><span class="si">{</span><span class="n">date_req</span><span class="si">}</span><span class="s">_ECCO_V4r4b_latlon_0p50deg.nc</span><span class="sh">"</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">./data/</span><span class="si">{</span><span class="n">file_req</span><span class="si">}</span><span class="sh">"</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">downloading: </span><span class="si">{</span><span class="n">date_req</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">ecco_url</span><span class="p">,</span> <span class="n">file_req</span><span class="p">)</span>

            <span class="c1"># let the downloader know the login credentials
</span>            <span class="n">downloader</span> <span class="o">=</span> <span class="nc">HTTPDownloader</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">)</span>
            <span class="nf">downloader</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="sh">"</span><span class="s">./data/{}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">file_req</span><span class="p">),</span> <span class="n">pooch</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

            <span class="n">dataset</span> <span class="o">=</span> <span class="n">xr</span><span class="p">.</span><span class="nf">open_dataset</span><span class="p">(</span><span class="sh">"</span><span class="s">./data/{}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">file_req</span><span class="p">))</span>
            <span class="n">dataset</span><span class="p">.</span><span class="nf">sel</span><span class="p">(</span>
                <span class="n">latitude</span>  <span class="o">=</span> <span class="n">lati</span><span class="p">,</span>
                <span class="n">longitude</span> <span class="o">=</span> <span class="n">longi</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="sh">'</span><span class="s">nearest</span><span class="sh">'</span><span class="p">)</span>
            
            <span class="n">datasets</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">ds_files</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">file_req</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">xr</span><span class="p">.</span><span class="nf">open_dataset</span><span class="p">(</span><span class="sh">"</span><span class="s">./data/{}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">file_req</span><span class="p">))</span>
            <span class="n">dataset</span><span class="p">.</span><span class="nf">sel</span><span class="p">(</span>
                <span class="n">latitude</span>  <span class="o">=</span> <span class="n">lati</span><span class="p">,</span>
                <span class="n">longitude</span> <span class="o">=</span> <span class="n">longi</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="sh">'</span><span class="s">nearest</span><span class="sh">'</span><span class="p">)</span>

            <span class="n">datasets</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">ds_files</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">file_req</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">ds_files</span>
</code></pre></div></div> <p>We access the data for each day, which is saved in the <code class="language-plaintext highlighter-rouge">date_req</code> variable. We loop through the each day in the range of dates specified for each tide gauge location, downloading the corresponding data file from the ECCO database, if the file wasn’t previously downloaded locally. Each file is opened and the data corresponding to the specified coordinates of the tide gauge locations is saved. We use <a href="https://docs.xarray.dev/en/stable/index.html" rel="external nofollow noopener" target="_blank">xarray</a> to handle the NC/NetCDF files, which is the format in which the SSH data is stored.</p> <p>We can test accessing the data for Hurricane Maria in the following code snippet:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">event_to_process</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Maria</span><span class="sh">"</span>
<span class="n">locations_to_process</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">storm_repo_full</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">tg_precise</span><span class="sh">"</span><span class="p">].</span><span class="nf">keys</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="n">locations_to_process</span><span class="p">)</span>
</code></pre></div></div> <p>Output:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">['Penuelas, PR (precise)', 'Isabel Segunda, PR (precise)', 'Esperanza, PR (precise)', 'Arecibo, PR (precise)', 'Mayaguez, PR (precise)', 'Fajardo, PR (precise)']
</span></code></pre></div></div> <p>The result is a list of the locations for which we want to analyze the SSH data.</p> <h4 id="ssh-data-retrieval-from-ecco">SSH data retrieval from ECCO</h4> <p>For ECCO, we retrieve the SSH data from each of the locations at a time. We use the previously defined function <code class="language-plaintext highlighter-rouge">get_ds_for_date_range</code> to retrieve the SSH data for the dates when the data was available for the tide gauge location, and save the dataset in <code class="language-plaintext highlighter-rouge">ds</code> together with its file name in <code class="language-plaintext highlighter-rouge">filename</code>. For each dataset, we select the closest gridcell coordinates which correspond to the location, and save it in <code class="language-plaintext highlighter-rouge">ds_sel</code>. We then concatenate the dataset in that location along the time dimension, and save the SSH data as an array and dataset.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start_date</span> <span class="o">=</span> <span class="n">storm_repo_full</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">tg_precise</span><span class="sh">"</span><span class="p">][</span><span class="n">location_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">record_start</span><span class="sh">"</span><span class="p">]</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">storm_repo_full</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">tg_precise</span><span class="sh">"</span><span class="p">][</span><span class="n">location_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">record_end</span><span class="sh">"</span><span class="p">]</span>

<span class="n">ds</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="nf">get_ds_for_date_range</span><span class="p">(</span>
                <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> 
                <span class="n">lati</span><span class="o">=</span><span class="n">storm_repo_full</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">tg_precise</span><span class="sh">"</span><span class="p">][</span><span class="n">location_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">],</span>
                <span class="n">longi</span><span class="o">=</span><span class="n">storm_repo_full</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">tg_precise</span><span class="sh">"</span><span class="p">][</span><span class="n">location_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">]</span>
                                    <span class="p">)</span>

<span class="n">ds_sel</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">.</span><span class="nf">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">storm_repo_full</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">tg_precise</span><span class="sh">"</span><span class="p">][</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">location_to_process</span><span class="si">}</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">lat</span><span class="sh">"</span><span class="p">],</span> 
<span class="n">longitude</span><span class="o">=</span><span class="n">storm_repo_full</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">tg_precise</span><span class="sh">"</span><span class="p">][</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">location_to_process</span><span class="si">}</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">lon</span><span class="sh">"</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="sh">'</span><span class="s">nearest</span><span class="sh">'</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">]</span>

<span class="n">ds_to_save</span> <span class="o">=</span> <span class="n">xr</span><span class="p">.</span><span class="nf">concat</span><span class="p">(</span><span class="n">ds_sel</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">done concat for </span><span class="si">{</span><span class="n">location_to_process</span><span class="p">[</span><span class="si">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">event_to_process</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">)</span>

<span class="n">np</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">./saved_arrays/ECCO_</span><span class="si">{</span><span class="n">event_to_process</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">location_to_process</span><span class="p">[</span><span class="si">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s">.npy</span><span class="sh">"</span><span class="p">,</span> <span class="n">ds_to_save</span><span class="p">[</span><span class="sh">"</span><span class="s">SSH</span><span class="sh">"</span><span class="p">].</span><span class="n">values</span><span class="p">)</span>

<span class="n">ds_to_save</span><span class="p">.</span><span class="nf">to_netcdf</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="s">./saved_ds/ECCO_</span><span class="si">{</span><span class="n">location_to_process</span><span class="p">[</span><span class="si">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s">.nc</span><span class="sh">"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <h4 id="ssh-data-retrieval-from-uhslctg">SSH data retrieval from UHSLC/TG</h4> <p>Finally, we retrieve the TG SSH data. We create a boolean variable <code class="language-plaintext highlighter-rouge">resample_tg</code>, which when true, allows us to resample the SSH data which is obtained per hour from the UHSLC/TG database, into daily format. We loop through all the TG locations associated with Hurricane Maria to retrieve and save the data. We use the urls previously defined in the <code class="language-plaintext highlighter-rouge">tg_repo</code> dictionary, then use xarray to read from the NetCDF files. We get the data specific to the dates when the tide gauge data was available for each tide gauge, and resample it to convert the data from hours into days. We convert the SSH data from millimeters to meters, then save the data in two formats; as an array(.npy) and as a dataset(.nc).</p> <p>We save the data both in .npy format and .nc format….npy files??? EXPLAIN WHY!!!</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locations_to_process</span><span class="p">:</span> 
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">doing: </span><span class="si">{</span><span class="n">event_to_process</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">loc</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">locations</span> <span class="o">=</span> <span class="n">tg_repo</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">event_to_process</span><span class="p">)</span>

    <span class="n">url_chosen</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">loc</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="p">.</span><span class="nf">open_dataset</span><span class="p">(</span><span class="n">pooch</span><span class="p">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="n">url_chosen</span><span class="p">,</span> <span class="n">known_hash</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>

    <span class="c1"># Cut the time of the event from ds
</span>    <span class="n">start_date</span> <span class="o">=</span> <span class="n">storm_repo_full</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">tg_precise</span><span class="sh">"</span><span class="p">][</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">loc</span><span class="si">}</span><span class="sh">'</span><span class="p">][</span><span class="sh">"</span><span class="s">record_start</span><span class="sh">"</span><span class="p">]</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">storm_repo_full</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="sh">"</span><span class="s">tg_precise</span><span class="sh">"</span><span class="p">][</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">loc</span><span class="si">}</span><span class="sh">'</span><span class="p">][</span><span class="sh">"</span><span class="s">record_end</span><span class="sh">"</span><span class="p">]</span>

    <span class="c1"># Get the event data
</span>    <span class="n">ds_event</span> <span class="o">=</span> <span class="n">ds</span><span class="p">.</span><span class="nf">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nf">slice</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">resample_tg</span><span class="p">:</span>
        <span class="n">resampled</span> <span class="o">=</span> <span class="n">ds_event</span><span class="p">.</span><span class="nf">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="sh">"</span><span class="s">D</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">resampled</span> <span class="o">=</span> <span class="n">resampled</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>
        
        <span class="n">np</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">./saved_arrays/TG_</span><span class="si">{</span><span class="n">event_to_process</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">loc</span><span class="p">[</span><span class="si">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s">.npy</span><span class="sh">"</span><span class="p">,</span> <span class="n">resampled</span><span class="p">.</span><span class="n">sea_level</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">flatten</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
        
        <span class="n">resampled</span><span class="p">.</span><span class="nf">to_netcdf</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="s">./saved_ds/TG_</span><span class="si">{</span><span class="n">loc</span><span class="p">[</span><span class="si">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s">.nc</span><span class="sh">"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> 
</code></pre></div></div> <h4 id="ssh-data-access-for-ecco">SSH data access for ECCO</h4> <p>To access the downloaded files of the ECCO SSH data, we create dictionaries to access the data in two formats; as a dataset (.nc file) and as a numpy array (.npy file) THIS SHOULD GO SOMEWHERE ELSE. If we want to access the data for Hurricane Maria and all the tide gauge locations, we can assign the following variables:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">event_to_process</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Maria</span><span class="sh">"</span>
<span class="n">locations_to_process</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">Isabel Segunda, PR (precise)</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Esperanza, PR (precise)</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Arecibo, PR (precise)</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Mayaguez, PR (precise)</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Fajardo, PR (precise)</span><span class="sh">"</span><span class="p">]</span>
</code></pre></div></div> <p>We then run the following code to access the SSH data:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds_allLoc_allEvent_ec</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># for the dataset
</span><span class="n">ds_allLoc_allEvent_ec</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">ar_allLoc_allEvent_ec</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># for the numpy array
</span><span class="n">ar_allLoc_allEvent_ec</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">locations_to_process</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">doing </span><span class="si">{</span><span class="n">i</span><span class="p">[</span><span class="si">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ds_loc</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ds_loc</span><span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="n">xr</span><span class="p">.</span><span class="nf">open_dataset</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">./saved_ds/ECCO_</span><span class="si">{</span><span class="n">i</span><span class="p">[</span><span class="si">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s">.nc</span><span class="sh">"</span><span class="p">)</span> 
    <span class="n">ds_allLoc_allEvent_ec</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="n">i</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ds_loc</span><span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span>

    <span class="n">ar_loc</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ar_loc</span><span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">./isp_saved_arrays/ECCO_</span><span class="si">{</span><span class="n">event_to_process</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">i</span><span class="p">[</span><span class="si">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s">.npy</span><span class="sh">"</span><span class="p">)</span> 
    <span class="n">ar_allLoc_allEvent_ec</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="n">i</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ar_loc</span><span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span>
</code></pre></div></div> <p>To confirm that we have the right data, we can check what is saved in the dictionaries.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="n">ds_allLoc_allEvent_ec</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">].</span><span class="nf">keys</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="n">ar_allLoc_allEvent_ec</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">].</span><span class="nf">keys</span><span class="p">())</span>
</code></pre></div></div> <p>The result is:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">dict_keys(['Isabel Segunda, PR', 'Esperanza, PR', 'Arecibo, PR', 'Mayaguez, PR', 'Fajardo, PR'])
dict_keys(['Isabel Segunda, PR', 'Esperanza, PR', 'Arecibo, PR', 'Mayaguez, PR', 'Fajardo, PR'])
</span></code></pre></div></div> <h4 id="ssh-data-access-for-uhslctg">SSH data access for UHSLC/TG</h4> <p>Likewise, we repeat the same process to access TG SSH data.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ar_allLoc_allEvent_tg</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># for the numpy array
</span><span class="n">ds_allLoc_allEvent_tg</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># for the dataset
</span>
<span class="n">ar_allLoc_allEvent_tg</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_allLoc_allEvent_tg</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">lo</span> <span class="ow">in</span> <span class="n">locations_to_process</span><span class="p">:</span> 
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">doing: </span><span class="si">{</span><span class="n">event_to_process</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">lo</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">ar_allLoc_allEvent_tg</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="n">lo</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">./saved_arrays/TG_</span><span class="si">{</span><span class="n">event_to_process</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">lo</span><span class="p">[</span><span class="si">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s">.npy</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ds_allLoc_allEvent_tg</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="n">lo</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="n">xr</span><span class="p">.</span><span class="nf">open_dataset</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">./saved_ds/</span><span class="si">{</span><span class="n">lo</span><span class="p">[</span><span class="si">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s">_TG.nc</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <h3 id="ssh-data-preliminary-analysis---only-for-hurricane-maria-dates">SSH data preliminary analysis - only for Hurricane Maria dates</h3> <p>We start by defining some helper functions. The <code class="language-plaintext highlighter-rouge">time_series_corr</code> function is used to calculate the correlation between ECCO and TG SSH time series for a given extreme weather event. This function takes the following parameters: <code class="language-plaintext highlighter-rouge">ar_allLoc_allEvent_tg</code> and <code class="language-plaintext highlighter-rouge">ar_allLoc_allEvent_ec</code>, which are both dictionaries containing SSH data from TGs and ECCO respectively, <code class="language-plaintext highlighter-rouge">event</code> which in our case is <code class="language-plaintext highlighter-rouge">"Maria"</code> and <code class="language-plaintext highlighter-rouge">normalize_zero</code>, a boolean which when true normalizes SSH data to have a mean value of zero.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">time_series_corr</span><span class="p">(</span><span class="n">ar_allLoc_allEvent_tg</span><span class="p">,</span> <span class="n">ar_allLoc_allEvent_ec</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">normalize_zero</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Event</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Location</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">Pearsons Statistic</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Pvalue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Min TG</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Max TG</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">Min SAT</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Max SAT</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Percent usable</span><span class="sh">"</span><span class="p">])</span>

    <span class="n">event_tg_data</span> <span class="o">=</span> <span class="n">ar_allLoc_allEvent_tg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">event_sat_data</span> <span class="o">=</span> <span class="n">ar_allLoc_allEvent_ec</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">tg_values</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">event_tg_data</span><span class="p">.</span><span class="nf">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">tg_values</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Convert 2D array to 1D by taking the mean along axis 0 (columns)
</span>            <span class="n">tg_values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">tg_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalize_zero</span><span class="p">:</span> <span class="c1"># No need to normalize the SSH data from the sat as it's already anomalies
</span>            <span class="n">tg_values</span> <span class="o">=</span> <span class="n">tg_values</span> <span class="o">-</span> <span class="n">tg_values</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>
        
        <span class="c1"># Find corresponding sat_data and plot its time series
</span>        <span class="k">if</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">event_sat_data</span><span class="p">:</span>
            <span class="n">sat_values</span> <span class="o">=</span> <span class="n">event_sat_data</span><span class="p">[</span><span class="n">location</span><span class="p">]</span>
            <span class="n">time_sat</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">sat_values</span><span class="p">))</span> <span class="o">*</span> <span class="mi">24</span>  <span class="c1"># Convert days to hours for x-axis
</span>            <span class="n">sat_values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">interp</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">tg_values</span><span class="p">)),</span> <span class="n">time_sat</span><span class="p">,</span> <span class="n">sat_values</span><span class="p">)</span>  <span class="c1"># Resample SAT data to hourly timescale
</span>            
            <span class="k">if</span> <span class="n">normalize_zero</span><span class="p">:</span>
                <span class="n">sat_values</span> <span class="o">=</span> <span class="n">sat_values</span> <span class="o">-</span> <span class="n">sat_values</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sat_values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">full_like</span><span class="p">(</span><span class="n">tg_values</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span>  <span class="c1"># If SAT data is missing, fill with NaNs
</span>
        <span class="n">bad</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="p">.</span><span class="nf">logical_or</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">tg_values</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">sat_values</span><span class="p">))</span>
        
        <span class="n">percent_usable</span> <span class="o">=</span> <span class="p">(</span><span class="n">bad</span><span class="p">.</span><span class="nf">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">bad</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">stats</span><span class="p">.</span><span class="nf">pearsonr</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">compress</span><span class="p">(</span><span class="n">bad</span><span class="p">,</span> <span class="n">tg_values</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="nf">compress</span><span class="p">(</span><span class="n">bad</span><span class="p">,</span> <span class="n">sat_values</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="sh">"</span><span class="s">TOO SHORT</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">TOO SHORT</span><span class="sh">"</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tg_values</span><span class="p">.</span><span class="nf">min</span><span class="p">(),</span> <span class="n">tg_values</span><span class="p">.</span><span class="nf">max</span><span class="p">(),</span> <span class="n">sat_values</span><span class="p">.</span><span class="nf">min</span><span class="p">(),</span> <span class="n">sat_values</span><span class="p">.</span><span class="nf">max</span><span class="p">(),</span> <span class="n">percent_usable</span><span class="p">]</span>
        <span class="n">results</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="nf">len</span><span class="p">(</span><span class="n">results</span><span class="p">)]</span> <span class="o">=</span> <span class="n">row</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></div> <p>Next, we define a function to plot the normalized time series comparing SSH data from ECCO and UHSLC/TG during Hurricane Maria. For this, we define a function <code class="language-plaintext highlighter-rouge">plot_time_series_combined</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_time_series_combined</span><span class="p">(</span>
    <span class="n">ar_allLoc_allEvent_tg</span><span class="p">,</span> 
    <span class="n">ar_allLoc_allEvent_ec</span><span class="p">,</span> 
    <span class="n">event</span><span class="p">,</span> 
    <span class="n">baseline_dict</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
    <span class="n">normalize_zero</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">has_been_resampled</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">xlab</span><span class="o">=</span><span class="sh">"</span><span class="s">xlab</span><span class="sh">"</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sh">"</span><span class="s">ylab</span><span class="sh">"</span><span class="p">,</span> <span class="n">type_sensor</span><span class="o">=</span><span class="sh">'</span><span class="s">sensor</span><span class="sh">'</span><span class="p">):</span>

    <span class="n">event_tg_data</span> <span class="o">=</span> <span class="n">ar_allLoc_allEvent_tg</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">event_sat_data</span> <span class="o">=</span> <span class="n">ar_allLoc_allEvent_ec</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="c1"># Create a plot for the time series
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">tg_values</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">event_tg_data</span><span class="p">.</span><span class="nf">items</span><span class="p">()):</span>
        <span class="c1"># Assuming tg_values is a NumPy array or a list
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">tg_values</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Convert 2D array to 1D by taking the mean along axis 0 (columns)
</span>            <span class="n">tg_values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">tg_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">time_tg</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">tg_values</span><span class="p">))</span>


        <span class="k">if</span> <span class="n">normalize_zero</span><span class="p">:</span> 
            <span class="n">tg_values</span> <span class="o">=</span> <span class="n">tg_values</span> <span class="o">-</span> <span class="n">tg_values</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">has_been_resampled</span><span class="p">:</span> 
            <span class="n">time_tg</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">tg_values</span><span class="p">))</span> <span class="o">*</span> <span class="mi">24</span>  <span class="c1"># Convert days to hours for x-axis
</span>            <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">time_tg</span><span class="p">,</span> <span class="n">tg_values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="nf">list</span><span class="p">(</span><span class="n">colors</span><span class="p">.</span><span class="nf">keys</span><span class="p">())[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s"> - TG Time Series</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Plot the tg_data time series
</span>            <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">time_tg</span><span class="p">,</span> <span class="n">tg_values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="nf">list</span><span class="p">(</span><span class="n">colors</span><span class="p">.</span><span class="nf">keys</span><span class="p">())[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s"> - TG Time Series</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Find corresponding sat_data and plot its time series
</span>        <span class="k">if</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">event_sat_data</span><span class="p">:</span>
            <span class="n">sat_values</span> <span class="o">=</span> <span class="n">event_sat_data</span><span class="p">[</span><span class="n">location</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">normalize_zero</span><span class="p">:</span>
                <span class="n">sat_values</span> <span class="o">=</span> <span class="n">sat_values</span> <span class="o">-</span> <span class="n">sat_values</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>
            
            <span class="n">time_sat</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">sat_values</span><span class="p">))</span> <span class="o">*</span> <span class="mi">24</span>  <span class="c1"># Convert days to hours for x-axis
</span>            <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">time_sat</span><span class="p">,</span> <span class="n">sat_values</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">'</span><span class="s">dashed</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="nf">list</span><span class="p">(</span><span class="n">colors</span><span class="p">.</span><span class="nf">keys</span><span class="p">())[</span><span class="n">idx</span><span class="p">]],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s"> - SAT Time Series</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Set plot properties
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Time Series for Event: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s"> [</span><span class="si">{</span><span class="n">type_sensor</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="sh">'</span><span class="s">upper left</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># Show the plot
</span>    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <p>We then define a function to get the baseline dates.”start_date”: datetime(2017, 9, 16), “end_date”: datetime(2017, 10, 2), This is done using two bounds placed around the reference date, which is the date when Hurricane Maria was at its peak???</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_baseline_date</span><span class="p">(</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">date_meaning</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="n">date_meaning</span> <span class="o">==</span> <span class="sh">"</span><span class="s">start</span><span class="sh">"</span><span class="p">:</span>
        <span class="c1"># Get the date 2 months prior to ref_date
</span>        <span class="n">bound1</span> <span class="o">=</span> <span class="n">ref_date</span> <span class="o">-</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="c1"># Get the date 1 month prior to ref_date
</span>        <span class="n">bound2</span> <span class="o">=</span> <span class="n">ref_date</span> <span class="o">-</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
               
    <span class="k">elif</span> <span class="n">date_meaning</span> <span class="o">==</span> <span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">:</span>
        <span class="c1"># Get the date 1 month post ref_date
</span>        <span class="n">bound1</span> <span class="o">=</span> <span class="n">ref_date</span> <span class="o">+</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="c1"># Get the date 2 months after ref_date
</span>        <span class="n">bound2</span> <span class="o">=</span> <span class="n">ref_date</span> <span class="o">+</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">Invalid date_meaning. Use </span><span class="sh">'</span><span class="s">start</span><span class="sh">'</span><span class="s"> or </span><span class="sh">'</span><span class="s">end</span><span class="sh">'</span><span class="s">.</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bound1</span><span class="p">,</span> <span class="n">bound2</span>
</code></pre></div></div> <p>In our preliminary analysis, we use Bland–Altman plots to determine the correlation between the SSH data from ECCO and the TGs. A Bland–Altman plot, also known as a difference plot, is a plot comparing two measurement techniques and assessing the agreement between two sets of data. It provides a visual representation of the difference between two measurements on the y-axis and the average of the two measurements on the x-axis [<a href="https://datatab.net/tutorial/bland-altman-plot" rel="external nofollow noopener" target="_blank">8</a>].</p> <p>To generate the Bland-Altman plots, we define the following function:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_bland_altman</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">locat</span><span class="p">,</span> <span class="n">ar_allLoc_allEvent_tg</span><span class="p">,</span> <span class="n">ar_allLoc_allEvent_sat</span><span class="p">):</span>
    <span class="n">tidal_gauge</span> <span class="o">=</span> <span class="n">ar_allLoc_allEvent_tg</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="n">locat</span><span class="p">]</span>
    <span class="n">satellite_altimetry</span> <span class="o">=</span> <span class="n">ar_allLoc_allEvent_sat</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="n">locat</span><span class="p">]</span>

    <span class="n">differences</span> <span class="o">=</span> <span class="n">tidal_gauge</span> <span class="o">-</span> <span class="n">satellite_altimetry</span>

    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">differences</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="p">.</span><span class="nf">all</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">differences</span><span class="p">)):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sh">'</span><span class="s">No data</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="sh">'</span><span class="s">center</span><span class="sh">'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="sh">'</span><span class="s">center</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">.</span><span class="nf">axis</span><span class="p">(</span><span class="sh">'</span><span class="s">off</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">No Data for </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s"> at </span><span class="si">{</span><span class="n">locat</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mean_difference</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">nanmean</span><span class="p">(</span><span class="n">differences</span><span class="p">)</span>
        <span class="n">std_difference</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">nanstd</span><span class="p">(</span><span class="n">differences</span><span class="p">)</span>
        <span class="n">upper_limit</span> <span class="o">=</span> <span class="n">mean_difference</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">std_difference</span>
        <span class="n">lower_limit</span> <span class="o">=</span> <span class="n">mean_difference</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">std_difference</span>

        <span class="n">plt</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">([</span><span class="n">tidal_gauge</span><span class="p">,</span> <span class="n">satellite_altimetry</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">differences</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">axhline</span><span class="p">(</span><span class="n">mean_difference</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Mean Difference</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">axhline</span><span class="p">(</span><span class="n">upper_limit</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">orange</span><span class="sh">'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Upper Limit</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">axhline</span><span class="p">(</span><span class="n">lower_limit</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">orange</span><span class="sh">'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Lower Limit</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Mean of Tidal Gauge and ECCO Altitude</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Difference (Tidal Gauge - ECCO Altitude)</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Bland-Altman Plot for </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s"> at </span><span class="si">{</span><span class="n">locat</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <p>GET ECCO AND TG DATA WITH BASELINES ONLY LEFT WITH THIS PART TO EXPLAIN!!!! WOOHOOO For the preliminary analysis, we analyzed SSH data within certain dates around Hurricane Maria.</p> <h4 id="statistical-analysis">Statistical analysis</h4> <p>To perform statistical analyses, we use the <code class="language-plaintext highlighter-rouge">time_series_corr</code> function previously described. It returns a dataframe containing correlation results, including the Pearson’s correlation coefficient, p-value, minimum and maximum values of ECCO and TG SSH data, and the percentage of usable SSH data.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">all_stat</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Event</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Location</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">Pearsons Statistic</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Pvalue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Min TG</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Max TG</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">Min SAT</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Max SAT</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Percent usable</span><span class="sh">"</span><span class="p">])</span>

<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">"</span><span class="s">Maria</span><span class="sh">"</span><span class="p">]:</span>
    <span class="n">event_stat</span> <span class="o">=</span> <span class="nf">time_series_corr</span><span class="p">(</span><span class="n">ar_allLoc_allEvent_tg</span><span class="p">,</span> <span class="n">ar_allLoc_allEvent_sat</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">normalize_zero</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">event_stat</span><span class="p">.</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">all_stat</span>   <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">all_stat</span><span class="p">,</span> <span class="n">event_stat</span><span class="p">])</span>

<span class="n">all_stat</span><span class="p">.</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">all_stat</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">./FINAL_RESULTS.csv</span><span class="sh">"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">all_stat</span>
</code></pre></div></div> <p>We get the following table as a result:</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_corr-480.webp 480w,/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_corr-800.webp 800w,/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_corr-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_corr.png" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Correlation results for ECCO and UHSLC/TG SSH data</figcaption> </figure> <p>Before generating Bland-Altman plots, we determine if it is possible to plot for all locations by running the following code:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">ar_allLoc_allEvent_tg</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">locat</span> <span class="ow">in</span> <span class="n">ar_allLoc_allEvent_tg</span><span class="p">[</span><span class="n">event</span><span class="p">].</span><span class="nf">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span> <span class="nf">plot_bland_altman</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">locat</span><span class="p">,</span> <span class="n">ar_allLoc_allEvent_tg</span><span class="p">,</span> <span class="n">ar_allLoc_allEvent_sat</span><span class="p">,</span> <span class="n">save_fig</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">plot_fig</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Excluded:</span><span class="se">\t</span><span class="s">event: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="se">\t\t</span><span class="s">Location: </span><span class="si">{</span><span class="n">locat</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>Output:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">Excluded:	event: Maria		Location: Fajardo, PR
</span></code></pre></div></div> <p>Fajardo is EXCLUDED BECAUSE ????</p> <p>To generate a Bland-Altman plot for Arecibo, for example, we call the function like this:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_bland_altman</span><span class="p">(</span><span class="sh">"</span><span class="s">Maria</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Arecibo, PR</span><span class="sh">"</span><span class="p">,</span> <span class="n">ar_allLoc_allEvent_tg</span><span class="p">,</span> <span class="n">ar_allLoc_allEvent_sat</span><span class="p">)</span>
</code></pre></div></div> <p>The following Bland-Altman plots are generated for Arecibo, Esperanza, Isabel Segunda and Mayaguez:</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog_pics/2024-03-23-CISP2023/bland_altman_plots-480.webp 480w,/assets/img/blog_pics/2024-03-23-CISP2023/bland_altman_plots-800.webp 800w,/assets/img/blog_pics/2024-03-23-CISP2023/bland_altman_plots-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/blog_pics/2024-03-23-CISP2023/bland_altman_plots.png" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Bland-Altman plots for Arecibo, Esperanza, Isabel Segunda and Mayaguez</figcaption> </figure> <p>We then plot the combined time series for the A MONTH BEFORE, AFTER HURRICANE MARIA???? EXPLAIN THE BASELINE THING</p> <p>We then call the function to generate the plot.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_time_series_combined</span><span class="p">(</span>
    <span class="n">ar_allLoc_allEvent_tg</span><span class="p">,</span> 
    <span class="n">ar_allLoc_allEvent_sat</span><span class="p">,</span> 
    <span class="n">event</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Maria</span><span class="sh">"</span><span class="p">,</span> 
    <span class="n">xlab</span><span class="o">=</span><span class="sh">"</span><span class="s">Time [hours]</span><span class="sh">"</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sh">"</span><span class="s">SSH [m]</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">baseline_dict</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
    <span class="n">normalize_zero</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_TG&amp;ECCO_during_Maria-480.webp 480w,/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_TG&amp;ECCO_during_Maria-800.webp 800w,/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_TG&amp;ECCO_during_Maria-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_TG&amp;ECCO_during_Maria.png" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Time series SSH comparison during Hurricane Maria</figcaption> </figure> <h4 id="discussion">Discussion</h4> <p>EXPLAIN WHAT WE SAW FROM PRELIMS AND WHY WE DID ANALYSIS OF ENTIRE TIME SERIES</p> <h3 id="ssh-data-analysis---entire-dataset">SSH data analysis - entire dataset</h3> <p>We perform some analyses on the data and generate plots to observe any trends in the SSH data obtained from ECCO and UHSLC/TG. For both data sources, we find, compare and plot the following:</p> <ul> <li>rolling mean comparison</li> <li>rolling standard deviation comparison</li> <li>pearson correlation of the rolling mean and rolling standard deviation</li> <li>pearson correlation for entire time series??? We compute the mean over rolling windows of 1000 hours.FIND BETTER WORDS??? Then find the pearson correlation coefficient and p-value by comparing the rolling mean and standard deviation plots obtained from both the ECCO and UHSLC/TG SSH data.</li> </ul> <h4 id="rolling-mean-comparison">Rolling mean comparison</h4> <p><code class="language-plaintext highlighter-rouge">ds_allLoc_allEvent_ec</code> and <code class="language-plaintext highlighter-rouge">ds_allLoc_allEvent_tg</code> are dictionaries in which the SSH datasets from ECCO and UHSLC/TG have been saved respectively. For example, to access the ECCO data for Hurricane Maria in Arecibo, we can call <code class="language-plaintext highlighter-rouge">ds_allLoc_allEvent_ec["Maria"]["Arecibo, PR"]</code>. We then convert the SSH data from millimeters into meters by dividing by 1000. After that, the data is normalized and plotted.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds_m_avg_sat</span> <span class="o">=</span> <span class="n">ds_allLoc_allEvent_ec</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="n">loc_to_process</span><span class="p">].</span><span class="n">SSH</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="n">ds_m_avg_tg</span> <span class="o">=</span> <span class="n">ds_allLoc_allEvent_tg</span><span class="p">[</span><span class="n">event_to_process</span><span class="p">][</span><span class="n">loc_to_process</span><span class="p">].</span><span class="n">sea_level</span><span class="p">.</span><span class="nf">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
<span class="n">ds_m_avg_tg</span> <span class="o">=</span> <span class="n">ds_m_avg_tg</span> <span class="o">/</span> <span class="mi">1000</span>

<span class="n">ds_m_avg_sat_normalized</span> <span class="o">=</span> <span class="n">ds_m_avg_sat</span> <span class="o">-</span> <span class="n">ds_m_avg_sat</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>
<span class="n">ds_m_avg_tg_normalized</span> <span class="o">=</span> <span class="n">ds_m_avg_tg</span> <span class="o">-</span> <span class="n">ds_m_avg_tg</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">ds_m_avg_sat_normalized</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">orange</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="s"> - ECCO Time series</span><span class="sh">'</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">ds_m_avg_tg_normalized</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">flatten</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="s"> - TG Time series</span><span class="sh">'</span><span class="p">)</span> 
  
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Time [*10 hours]</span><span class="sh">"</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">SSH [m]</span><span class="sh">"</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Time Series Rolling Mean for Event: </span><span class="si">{</span><span class="n">event_to_process</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">loc_to_process</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="sh">'</span><span class="s">upper left</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span> 
</code></pre></div></div> <p>The code above generates the following plot for Mayaguez:</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog_pics/2024-03-23-CISP2023/mayaguez_rolling_mean-480.webp 480w,/assets/img/blog_pics/2024-03-23-CISP2023/mayaguez_rolling_mean-800.webp 800w,/assets/img/blog_pics/2024-03-23-CISP2023/mayaguez_rolling_mean-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/blog_pics/2024-03-23-CISP2023/mayaguez_rolling_mean.png" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Time series SSH rolling mean comparison for Mayaguez</figcaption> </figure> <h4 id="rolling-standard-deviation-comparison">Rolling standard deviation comparison</h4> <p>The same code can be reused to generate plots for the rolling standard deviation comparison by making a few changes to the variables to be plotted.</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">-ds_m_avg_sat_normalized = ds_m_avg_sat - ds_m_avg_sat.mean()
-ds_m_avg_tg_normalized = ds_m_avg_tg - ds_m_avg_tg.mean()
</span><span class="gi">+ds_m_std_sat_normalized = ds_m_std_sat - ds_m_std_sat.mean()
+ds_m_std_tg_normalized = ds_m_std_tg - ds_m_std_tg.mean()
</span></code></pre></div></div> <p>The following plot is then generated for Mayaguez:</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog_pics/2024-03-23-CISP2023/mayaguez_rolling_std-480.webp 480w,/assets/img/blog_pics/2024-03-23-CISP2023/mayaguez_rolling_std-800.webp 800w,/assets/img/blog_pics/2024-03-23-CISP2023/mayaguez_rolling_std-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/blog_pics/2024-03-23-CISP2023/mayaguez_rolling_std.png" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Time series SSH rolling standard deviation comparison for Mayaguez</figcaption> </figure> <h4 id="pearson-correlations">Pearson correlations</h4> <p>We also compute the pearson correlation coefficient and p-value comparing the SSH data from ECCO and UHSLC/TG for each location. We create a function <code class="language-plaintext highlighter-rouge">make_arrays_same_length</code>, which ensures that both data arrays in the comparison are of the same length.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_arrays_same_length</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">):</span>
    <span class="n">len1</span><span class="p">,</span> <span class="n">len2</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">arr1</span><span class="p">),</span> <span class="nf">len</span><span class="p">(</span><span class="n">arr2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">len1</span> <span class="o">!=</span> <span class="n">len2</span><span class="p">:</span>
        <span class="n">min_len</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">len1</span><span class="p">,</span> <span class="n">len2</span><span class="p">)</span>
        <span class="n">arr1</span> <span class="o">=</span> <span class="n">arr1</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
        <span class="n">arr2</span> <span class="o">=</span> <span class="n">arr2</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span>
</code></pre></div></div> <p>An example code snippet showing the pearson correlation and p-value calculations of the standard deviation for WHICH LOCATION??? is shown below. EXPLAIN THE FLATTENING EXPLAIN THE PEARSON FUNCTION</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">corr_val_ds_ec</span> <span class="o">=</span> <span class="n">ds_m_std_sat_normalized</span>
<span class="n">corr_val_ds_tg</span> <span class="o">=</span> <span class="n">ds_m_std_tg_normalized</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">flatten</span><span class="p">()</span>

<span class="n">corr_val_ds_ec</span><span class="p">,</span> <span class="n">corr_val_ds_tg</span> <span class="o">=</span> <span class="nf">make_arrays_same_length</span><span class="p">(</span><span class="n">corr_val_ds_ec</span><span class="p">,</span> <span class="n">corr_val_ds_tg</span><span class="p">)</span>

<span class="n">correlation_coefficient</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="nf">pearsonr</span><span class="p">(</span><span class="n">corr_val_ds_ec</span><span class="p">,</span> <span class="n">corr_val_ds_tg</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Pearson correlation coefficient: </span><span class="si">{</span><span class="n">correlation_coefficient</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">P-value: </span><span class="si">{</span><span class="n">p_value</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>Output:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">Pearson correlation coefficient: 0.3865297618168296
P-value: 9.630575093800546e-113
</span></code></pre></div></div> <h4 id="time-series-plotting">Time series plotting</h4> <p>Plotting time series for entire dataset for both ECCO and tidal gauge data, and for each tidal gauge location…WHY??</p> <p>We then generate the time series plots by calling the function.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">plot_time_series_specific_location</span><span class="p">(</span>
    <span class="n">ar_allLoc_allEvent_tg</span><span class="p">,</span> 
    <span class="n">ar_allLoc_allEvent_ec</span><span class="p">,</span> 
    <span class="n">event_to_process</span><span class="p">,</span> 
    <span class="n">location</span><span class="o">=</span> <span class="sh">'</span><span class="s">Isabel Segunda, PR</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">xlab</span><span class="o">=</span><span class="sh">"</span><span class="s">Time [hours]</span><span class="sh">"</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sh">"</span><span class="s">SSH [m]</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">normalize_zero</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">resample_tg</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">save_fig</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">plot_fig</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>Time series plot of SSH data from ECCO and TGs during Hurricane Maria:</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_esperanza-480.webp 480w,/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_esperanza-800.webp 800w,/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_esperanza-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_esperanza.png" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Full time series SSH comparison for Esperanza</figcaption> </figure> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_fajardo-480.webp 480w,/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_fajardo-800.webp 800w,/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_fajardo-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/blog_pics/2024-03-23-CISP2023/timeseries_fajardo.png" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Full time series SSH comparison for Fajardo</figcaption> </figure> <h4 id="discussion-1">Discussion</h4> <p>INCLUDE SCREENSHOTS OF THE PEARSONS TABLE, OR JUST DO THE TABLE IN MARKDOWN HERE</p> <h2 id="conclusion">Conclusion</h2> <h3 id="notes">Notes</h3> <p>The complete Jupyter notebook for this code can be found <a href="GIVE%20LINKS%20FOR%20EACH%20SECTION%20AND%20ITS%20NOTEBOOK">here</a></p> <p>If you would like to read/watch the presentation of our project during the CISP seminar, find the slides here and the recording <a href="https://www.youtube.com/watch?v=_mT-hI692f8" rel="external nofollow noopener" target="_blank">here</a>. PUT THE SLIDES</p> <h3 id="acknowledgements">Acknowledgements</h3> <p>Most of this work was developed during the Climatematch Impact Scholars Program hosted by Climatematch Academy. Computing and storage resources during the program were supported by ‘An Open, Community Supported, Accessible Summer School for Climate Science, National Aeronautics and Space Administration’ (Award #80NSSC23K0835). I would like to thank my teammates, <a href="https://github.com/FranckPrts" rel="external nofollow noopener" target="_blank">Franck</a> and <a href="https://github.com/hlili303" rel="external nofollow noopener" target="_blank">Hannah</a>, who I worked with in this project, and <a href="https://scholar.google.com/citations?user=DS2JzHwAAAAJ&amp;hl=en" rel="external nofollow noopener" target="_blank">Fabrizio Falasca</a>, who mentored us during the latter part of the project.</p> <h3 id="references">References</h3> <p>[1] Sea Level Rise - Woods Hole Oceanographic Institution: <a href="https://www.whoi.edu/know-your-ocean/ocean-topics/climate-weather/sea-level-rise/" rel="external nofollow noopener" target="_blank">https://www.whoi.edu/know-your-ocean/ocean-topics/climate-weather/sea-level-rise/</a></p> <p>[2] What is a tide gauge?: <a href="https://oceanservice.noaa.gov/facts/tide-gauge.html" rel="external nofollow noopener" target="_blank">https://oceanservice.noaa.gov/facts/tide-gauge.html</a></p> <p>[3] Ichikawa, K., Wang, X., Tamura, H., &amp; Wei, D. (2022). Sea surface height and significant wave height estimations in the calm semienclosed Celebes Sea. Coastal Altimetry, 109-134. <a href="https://doi.org/10.1016/B978-0-323-91708-7.00011-0" rel="external nofollow noopener" target="_blank">https://doi.org/10.1016/B978-0-323-91708-7.00011-0</a></p> <p>[4] Sea Level Trends - NOAA Tides and Currents: <a href="https://tidesandcurrents.noaa.gov/sltrends/" rel="external nofollow noopener" target="_blank">https://tidesandcurrents.noaa.gov/sltrends/</a></p> <p>[5] ECCO Version 4 Release 4 Dataset ECCO Consortium, Fukumori, I., Wang, O., Fenty, I., Forget, G., Heimbach, P., &amp; Ponte, R. M. ECCO Central Estimate (Version 4 Release 4). Retrieved from <a href="https://data.nas.nasa.gov/ecco/data.php?dir=/eccodata/llc_90/ECCOv4/Release4" rel="external nofollow noopener" target="_blank">https://data.nas.nasa.gov/ecco/data.php?dir=/eccodata/llc_90/ECCOv4/Release4</a></p> <p>[6] ECCO Consortium, Fukumori, I., Wang, O., Fenty, I., Forget, G., Heimbach, P., &amp; Ponte, R. M. (2021, February 10). Synopsis of the ECCO Central Production Global Ocean and Sea-Ice State Estimate (Version 4 Release 4). <a href="https://doi.org/10.5281/zenodo.4533349" rel="external nofollow noopener" target="_blank">https://doi.org/10.5281/zenodo.4533349</a></p> <p>[7] Forget, G., J.-M. Campin, P. Heimbach, C. N. Hill, R. M. Ponte, and C. Wunsch, 2015: ECCO version 4: An integrated framework for non-linear inverse modeling and global ocean state estimation. Geoscientific Model Development, 8. <a href="https://www.geosci-model-dev.net/8/3071/2015/" rel="external nofollow noopener" target="_blank">https://www.geosci-model-dev.net/8/3071/2015/</a></p> <p>[8] Bland-Altman plot(simply explained) - DATAtab: <a href="https://datatab.net/tutorial/bland-altman-plot" rel="external nofollow noopener" target="_blank">https://datatab.net/tutorial/bland-altman-plot</a></p> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Faith Hunja. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: May 09, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>